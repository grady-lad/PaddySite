define(["backbone","jquery","events","lib/jquery.cloudinary"],function(e,t,n,r){var i=e.View.extend({el:"#panelUpload",initialize:function(){this.setUpForm(),t(".loading").hide()},events:{"click .uploadbutton":"testy"},testy:function(e){e.preventDefault();var n;t(".hiddenUpload").val()?(n=JSON.parse(t(".hiddenUpload").val()),this.collection.create({image:n},{error:function(e,n){t(".status").text("Could not upload image ?")},success:function(e,n){t(".preview").html("")}})):t(".status").text("Pick a photo to upload ya dope")},setUpForm:function(){t.cloudinary.config({api_key:"932255541789328",cloud_name:"dzx1ez426"}),t(".cloudinary-fileupload").unsigned_cloudinary_upload("t4d6bca8",{disableImageResize:!1,imageMaxWidth:1e3,imageMaxHeight:1e3,acceptFileTypes:"/(.|/)(gif|jpe?g|png|bmp|ico)$/i",maxFileSize:5e6}).bind("cloudinaryprogress",function(e,n){t(".status").text("Uploading... "+Math.round(n.loaded*100/n.total)+"%")}).bind("cloudinaryfail",function(e,n){t(".status").text("upload failed")}).off("cloudinarydone").on("cloudinarydone",function(e,n){t(".status").text("");var r=t(".preview").html("");t.cloudinary.image(n.result.public_id,{format:n.result.format,width:200,height:200,crop:"fill"}).appendTo(r),t("<a>").addClass("delete_by_token").attr({href:"#"}).data({delete_token:n.result.delete_token}).html("remove").appendTo(r).click(function(e){e.preventDefault(),t.cloudinary.delete_by_token(t(this).data("delete_token")).done(function(){t(".preview").html(""),t("#info").html(""),t("#photo_bytes").val(""),t(".hiddenUpload").remove(),t('input[name="photo[image]"]').remove()}).fail(function(){t(".status").text("Cannot delete image")})})})}});return i});